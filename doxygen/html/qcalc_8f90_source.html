<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>qsource: qcalc.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">qsource
   &#160;<span id="projectnumber">5.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a></li><li class="navelem"><a class="el" href="dir_cc5e21463aaf155987874daa84db6d6e.html">esguerra</a></li><li class="navelem"><a class="el" href="dir_284fb529e48f121476ccd3fb306e3724.html">software</a></li><li class="navelem"><a class="el" href="dir_4a0e131d5eef10c09c58134c0408801b.html">qsource</a></li><li class="navelem"><a class="el" href="dir_c37daa0d9a5d62d04ec5bab6920011a0.html">development</a></li><li class="navelem"><a class="el" href="dir_2dba9ad2b677b18ac1a30973c57ed176.html">esguerra</a></li><li class="navelem"><a class="el" href="dir_1aaa6e4bc4376284103de70ac85f4569.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">qcalc.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qcalc_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!       (C) 2000 Uppsala Molekylmekaniska HB, Uppsala, Sweden</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!       qcalc.f90</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!       by John Marelius</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!       Qcalc trajectory analysis main program</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#af9a59510ab33b6a61b0bffe1e6679be1">    6</a></span>&#160;<span class="keyword">program</span> <a class="code" href="qcalc_8f90.html#af9a59510ab33b6a61b0bffe1e6679be1">qcalc</a></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classtrj.html">trj</a></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__base.html">calc_base</a></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__rms.html">calc_rms</a></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__fit.html">calc_fit</a></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__geom.html">calc_geom</a></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__entropy.html">calc_entropy</a></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__nb.html">calc_nb</a>                             </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__chemscore.html">calc_chemscore</a></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__xscore.html">calc_xscore</a></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__pmf.html">calc_pmf</a></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__rdf.html">calc_rdf</a></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__rmsf.html">calc_rmsf</a></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__com__ke.html">calc_com_ke</a></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="keywordtype">use </span><a class="code" href="classcalc__com.html">calc_com</a></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="comment">!add more calculation kind modules here...</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="comment">! version data</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keywordtype">character(*)</span>, <span class="keywordtype">parameter</span> ::      program_version = <span class="stringliteral">&#39;5.01&#39;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keywordtype">character(*)</span>, <span class="keywordtype">parameter</span> ::      program_date = <span class="stringliteral">&#39;2003-06-03&#39;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="comment">!constants</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>                      ::      max_calcs = 99</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>                      ::      max_calc_kinds = 99</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="comment">!data types  </span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="code" href="structcalc__type.html">   34</a></span>&#160;        <span class="keyword">type</span> <a class="code" href="structcalc__type.html">calc_type</a></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="structcalc__type.html#ae59927d51da49ed953e75139df0bc97d">   35</a></span>&#160;                <span class="keywordtype">character(len=60)</span>               ::      desc</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="code" href="structcalc__type.html#a30aaeaab9272f5ff5cdaeb3c3fe8c8bf">   36</a></span>&#160;                <span class="keywordtype">integer</span>                                 ::      i</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="code" href="structcalc__type.html#adf6e4b278e6edf39f7a833d329f1f493">   37</a></span>&#160;                <span class="keywordtype">integer</span>                                 ::      typ</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">        end type </span><a class="code" href="structcalc__type.html">calc_type</a></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="code" href="structcalc__kind__type.html">   40</a></span>&#160;        <span class="keyword">type</span> <a class="code" href="structcalc__kind__type.html">calc_kind_type</a></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="code" href="structcalc__kind__type.html#a0d467a665291d2896a86210c3e902daa">   41</a></span>&#160;                <span class="keywordtype">character(len=40)</span>               ::      desc</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="structcalc__kind__type.html#a599466b5a5180588df96533095eb465f">   42</a></span>&#160;                <span class="keywordtype">character(len=14)</span>               ::      key</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="code" href="structcalc__kind__type.html#a71d007604eeaa1cbddfa68dd79c8f2ec">   43</a></span>&#160;                <span class="keywordtype">logical</span>                                 ::      output</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">        end type </span><a class="code" href="structcalc__kind__type.html">calc_kind_type</a>                         </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordtype">integer</span>                                         ::      Nkinds = 0, Ncalcs = 0</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordtype">type(</span><a class="code" href="structcalc__kind__type.html">calc_kind_type</a><span class="keywordtype">)</span>            ::      cdef(MAX_CALC_KINDS)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordtype">type(</span><a class="code" href="structcalc__type.html">calc_type</a><span class="keywordtype">)</span>                         ::      calcs(MAX_CALCS)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="comment">!register the calculation kinds</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;RMS coord. deviation&#39;</span>,              key=<span class="stringliteral">&#39;rmsd&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Least squares fit&#39;</span>,                         key=<span class="stringliteral">&#39;fit&#39;</span>, output=.false.)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Distance, bond energy&#39;</span>,             key=<span class="stringliteral">&#39;dist&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Angle, angle energy&#39;</span>,                       key=<span class="stringliteral">&#39;angle&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Torsion, torsion energy&#39;</span>, key=<span class="stringliteral">&#39;torsion&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Entropy [Schlitters formula]&#39;</span>, key=<span class="stringliteral">&#39;entropy&#39;</span>, output=.true.) </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Nonbonded monitor&#39;</span>,                         key=<span class="stringliteral">&#39;nonbond&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Residue nonbond monitor&#39;</span>, key=<span class="stringliteral">&#39;nb_prot_qatom&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;ChemScore&#39;</span>,                                                         key=<span class="stringliteral">&#39;chemscore&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;X-Score&#39;</span>,                                                                   key = <span class="stringliteral">&#39;xscore&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;PMF-Score&#39;</span>,                                                         key = <span class="stringliteral">&#39;pmfscore&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;RDF&#39;</span>,                                                               key = <span class="stringliteral">&#39;rdf&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;RMSF&#39;</span>,                                                              key = <span class="stringliteral">&#39;rmsf&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Center of mass Kinetic Energy&#39;</span>,             key = <span class="stringliteral">&#39;com_ke&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        call <a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc=<span class="stringliteral">&#39;Center of mass position&#39;</span>,           key = <span class="stringliteral">&#39;com&#39;</span>, output=.true.)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">!add more calc. kind registrations here...</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">! startup prints welcome msg and calls calc_help to print </span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment">! helper info. mask_startup and topo_startup are dummy routines</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        call <a class="code" href="qcalc_8f90.html#a1c4c0aa57a695916669518b5bf72e5bb">startup</a></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="qcalc_8f90.html#aacaa8facde5f0fb39d3129c9777ca2d6">get_topology</a>()) <span class="keywordflow">then</span>         <span class="comment">! attempt to load topology (req. user input)</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                                                                                                <span class="comment">! reads bnd(:) among other things</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                call <a class="code" href="qcalc_8f90.html#abfa70c406b1c701bcea2c55234d0642d">initialize</a>                 <span class="comment">! initialize modules, mostly allocating arrays and def.ing constants</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                call <a class="code" href="qcalc_8f90.html#acaadc7e7a89c09e2f5d003ad5dca1672">add_calcs</a>                  <span class="comment">! display calc menu and add calcs</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                call <a class="code" href="qcalc_8f90.html#a6de35d783d8e2c1ffead6a9dbf61ebb6">do_pre_calcs</a></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                call <a class="code" href="qcalc_8f90.html#accba7d2752af0a562a170bd24016fc8b">process_help</a></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                call <a class="code" href="qcalc_8f90.html#aef9b17e9b0d2c7dda08ad0e502c7369f">print_headings</a></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                call <a class="code" href="qcalc_8f90.html#a7d2d447954fb385bdca4f228de92b1eb">process_data</a>               <span class="comment">! processes data frame by frame</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                               </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                call <a class="code" href="qcalc_8f90.html#ad7e945159c2c3479ab13f7fe344ed0ac">finalize_topology</a></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                call <a class="code" href="qcalc_8f90.html#ae13666592a639e38acc4462b8e5ec488">finalize</a></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="keyword">write</span>(*,900)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;900             <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: Failed to load topology. Exiting&#39;</span>)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        call <a class="code" href="qcalc_8f90.html#ab8b2551c119768488c4ce752918274a6">shutdown</a></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">contains</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a1c4c0aa57a695916669518b5bf72e5bb">   97</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a1c4c0aa57a695916669518b5bf72e5bb">startup</a></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordtype">integer</span>                                         ::      i</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(79a)&#39;</span>)(<span class="stringliteral">&#39;#&#39;</span>,i=1,79)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(a,a)&#39;</span>) <span class="stringliteral">&#39;Welcome to Qcalc version &#39;</span>,program_version</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        call <a class="code" href="classatom__mask.html#a5499bfab148e68b797181ace7ee2e744">mask_startup</a>       <span class="comment">! mask_startup calls topo_startup, which is empty</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        call <a class="code" href="qcalc_8f90.html#a0916b2e52eb485b7c054ceeaa3bcc6bc">calc_help</a>          <span class="comment">! outputs help to screen</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a1c4c0aa57a695916669518b5bf72e5bb">startup</a></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#ab8b2551c119768488c4ce752918274a6">  110</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#ab8b2551c119768488c4ce752918274a6">shutdown</a></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#ab8b2551c119768488c4ce752918274a6">shutdown</a></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#aacaa8facde5f0fb39d3129c9777ca2d6">  113</a></span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="qcalc_8f90.html#aacaa8facde5f0fb39d3129c9777ca2d6">get_topology</a>()</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">!locals</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordtype">character(len=200)</span>                      :: topfile</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        call <a class="code" href="classmisc.html#a49b44c33311a31e874439a6f3caf5801">getlin</a>(topfile, <span class="stringliteral">&#39;--&gt; Topology file: &#39;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keyword">write</span>(*,100) trim(topfile)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;100     <span class="keyword">format</span>(<span class="stringliteral">&#39;Loading topology &#39;</span>,a)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <a class="code" href="qcalc_8f90.html#aacaa8facde5f0fb39d3129c9777ca2d6">get_topology</a> = <a class="code" href="classtopo.html#aac0681f14a49bb07e5cbb3a877b1e5dd">topo_load</a>(topfile, require_version=4.)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">end function </span><a class="code" href="qcalc_8f90.html#aacaa8facde5f0fb39d3129c9777ca2d6">get_topology</a></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#abfa70c406b1c701bcea2c55234d0642d">  124</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#abfa70c406b1c701bcea2c55234d0642d">initialize</a></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keyword">allocate</span>(xin(3*nat_pro))   <span class="comment">! contains all coordinates, 3*no_atoms</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        call <a class="code" href="classcalc__rms.html#aa5acf10d18cc6a1f64f3388951dbd5fd">rms_initialize</a></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        call <a class="code" href="classcalc__rmsf.html#a9179b37a9a78d886358be738afc6cb67">rmsf_initialize</a></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        call <a class="code" href="classcalc__fit.html#aa5c549c9ee1237fd1557b2067ce0f4b3">fit_initialize</a></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        call <a class="code" href="classcalc__geom.html#ae3a4d06138ec68ee527ca3722472b614">geom_initialize</a></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        call <a class="code" href="classcalc__entropy.html#a9d1d1405c17e8adf37d4832bc14142c5">entropy_initialize</a>                                    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        call <a class="code" href="classcalc__nb.html#a1bbfcf548dec05c1bb35e51bb01451ee">nb_initialize</a>         </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        call <a class="code" href="classcalc__chemscore.html#af6e984aa1653e69de2ec2a501c90913d">score_initialize</a>          </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        call <a class="code" href="classcalc__xscore.html#a0bf9c5725696dfd8e6afd92c7eae7b86">xscore_initialize</a></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        call <a class="code" href="classcalc__pmf.html#acfa385c68b0b238d175af42417a8209b">pmf_initialize</a></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        call <a class="code" href="classcalc__rdf.html#a70120abf4305f3ab2df1ab09476a9d34">rdf_initialize</a></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        call <a class="code" href="classcalc__com__ke.html#abc5eddcd6ef58c3f77818ce4e55e32f2">com_ke_initialize</a></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        call <a class="code" href="classcalc__com.html#ad6243ed04b2e3251f61360aa1e04b1b0">com_initialize</a></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">!add more calls to module initialization routines here</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#abfa70c406b1c701bcea2c55234d0642d">initialize</a></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a6de35d783d8e2c1ffead6a9dbf61ebb6">  141</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a6de35d783d8e2c1ffead6a9dbf61ebb6">do_pre_calcs</a></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordtype">integer</span>                                         ::      c, i</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">do</span> c = 1, ncalcs</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                i = calcs(c)%i</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(c)%typ)%key)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                call <a class="code" href="classcalc__chemscore.html#a1dbdeb7c4eb3b9068a041f3b08224417">score_precalc</a></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                call <a class="code" href="classcalc__xscore.html#a1dd20b02356cb3c99283799d1030d1ba">xscore_precalc</a></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                call <a class="code" href="classcalc__pmf.html#a15f551fc2681bc20e67c32c26f0e6213">pmf_precalc</a></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;       <span class="comment">!add more call to calculation pre-routines here...</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         <span class="keywordflow">end do</span> </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">end subroutine</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#ae13666592a639e38acc4462b8e5ec488">  159</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#ae13666592a639e38acc4462b8e5ec488">finalize</a></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordtype">integer</span>                                         ::      c, i</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keyword">deallocate</span>(xin)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">do</span> c=1, ncalcs</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <span class="keywordflow">if</span>(cdef(calcs(c)%typ)%output) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        i = calcs(c)%i</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                        <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(c)%typ)%key)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsd&#39;</span>)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                call <a class="code" href="classcalc__rms.html#a4753dc26621e5a66675acefb3e85b0ba">rms_finalize</a>(i)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;fit&#39;</span>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                call <a class="code" href="classcalc__fit.html#ad14c1235965e5604af2221fe382c98dd">fit_finalize</a>(i)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;entropy&#39;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                            call <a class="code" href="classcalc__entropy.html#a8b7097d5478f130ec2b04ac4eb69e156">entropy_finalize</a>(i)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nonbond&#39;</span>)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                            call <a class="code" href="classcalc__nb.html#ad4b4eb1aad0d5e40cbf07579ca5306de">nb_finalize</a>(i)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nb_prot_qatom&#39;</span>)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                            call <a class="code" href="classcalc__nb.html#ac6032c768a8f42bc47e597e359478356">nb_qp_finalize</a>()</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;dist&#39;</span>, <span class="stringliteral">&#39;angle&#39;</span>, <span class="stringliteral">&#39;torsion&#39;</span>, <span class="stringliteral">&#39;improper&#39;</span>)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                                <span class="comment">!nothing needed</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                call <a class="code" href="classcalc__chemscore.html#ae933b171a206adf49ec5cde460082f5a">chemscore_finalize</a></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                call <a class="code" href="classcalc__xscore.html#a520f096fd642c5abc03bcb0cd9ee421b">xscore_finalize</a></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                call <a class="code" href="classcalc__pmf.html#abaffcc0fb18adf0a3084d8a6a0be60e6">pmf_finalize</a></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rdf&#39;</span>)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                call <a class="code" href="classcalc__rdf.html#a4fe98fe00b67ceadd0ce93d9a9eae6a7">rdf_finalize</a>(i)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsf&#39;</span>)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                call <a class="code" href="classcalc__rmsf.html#a7ea65c84cbb1c6f49010270f617d3340">rmsf_finalize</a>(i)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com_ke&#39;</span>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                call <a class="code" href="classcalc__com__ke.html#a089d44e2e8eacfbd26da425a497530c5">com_ke_finalize</a>(i)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com&#39;</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                call <a class="code" href="classcalc__com.html#a45389417b8edfa5f656068b71161be03">com_finalize</a>(i)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        <span class="comment">!add more call to finalize routines here...</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        call <a class="code" href="classatom__mask.html#a14396a493fa6fda90515fd946a68e90b">mask_shutdown</a></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#ae13666592a639e38acc4462b8e5ec488">finalize</a></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a0916b2e52eb485b7c054ceeaa3bcc6bc">  204</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a0916b2e52eb485b7c054ceeaa3bcc6bc">calc_help</a></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keyword">WRITE</span>( * , <span class="stringliteral">&#39;(a)&#39;</span>) &amp;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="stringliteral">&#39;Qcalc works in three stages:&#39;</span>, &amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="stringliteral">&#39;1. Load topology.&#39;</span>, &amp;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="stringliteral">&#39;2. Set up a list of calculations to make.&#39;</span>, &amp;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="stringliteral">&#39;3. Read coordinates from trajectory and/or restart files and calculate.&#39;</span> </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a0916b2e52eb485b7c054ceeaa3bcc6bc">calc_help</a></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#accba7d2752af0a562a170bd24016fc8b">  213</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#accba7d2752af0a562a170bd24016fc8b">process_help</a></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        call <a class="code" href="classmisc.html#ac616bbb70212f3216e099c51f3c217f9">centered_heading</a>(<span class="stringliteral">&#39;Help for reading coordinate files&#39;</span>,<span class="stringliteral">&#39;-&#39;</span>)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keyword">WRITE</span>( * , <span class="stringliteral">&#39;(a)&#39;</span>) &amp;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="stringliteral">&#39;Enter names of coordinate files (restart or trajectory) on separate lines&#39;</span>, &amp;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="stringliteral">&#39;Terminate with EOF or period (.).&#39;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#accba7d2752af0a562a170bd24016fc8b">process_help</a></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#ae9f414aacd475e3507c1adf33981cabf">  221</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#ae9f414aacd475e3507c1adf33981cabf">finishtrj_all</a></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">! this sub invokes corresponding end-of-trajectory functions in calc. modules</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">! when end of trj file is reached</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">! used by score to calculate mean</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!       call score_calc_mean</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">! add more calls here</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#ae9f414aacd475e3507c1adf33981cabf">finishtrj_all</a></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a7d2d447954fb385bdca4f228de92b1eb">  230</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a7d2d447954fb385bdca4f228de92b1eb">process_data</a></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">!locals</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordtype">character(len=256)</span>:: cf <span class="comment">!coord file name</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordtype">integer</span>                                         :: fn <span class="comment">!LUN for cf</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordtype">real(8)</span>                                         :: rms</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordtype">integer</span>                                         :: frame,p1,p2,frame_start,frame_end,every_n</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordtype">character(len=80)</span>       :: frames</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">do</span> <span class="keywordflow">while</span>(<a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a>(cf, fn,frames))</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                every_n = 0</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">if</span>(frames.ne.<span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                        p1 = index(frames,<span class="stringliteral">&#39;=&#39;</span>)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                        p2 = index(frames,<span class="stringliteral">&#39;-&#39;</span>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                        <span class="keywordflow">if</span>(p2.ne.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                <span class="keyword">read</span>(frames(p1+1:p2-1),*) frame_start</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                <span class="keyword">read</span>(frames(p2+1:len_trim(frames)),*) frame_end</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                frames = frames(p1+1:80)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                                <span class="keywordflow">if</span>(frames(1:5).eq.<span class="stringliteral">&#39;every&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                        <span class="keyword">read</span>(frames(6:80),*) every_n</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                frame = 0</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">if</span>(fn /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        <span class="comment">! restart file</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">load_restart</a>(fn)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                call <a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a>(cf, 0)               <span class="comment">! was process_frame(cf,1)</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="comment">! trajectory file</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <span class="keywordflow">do</span> <span class="keywordflow">while</span>(<a class="code" href="classtrj.html#a87cdf9b41b59045660320062201537c0">trj_read</a>(xin))</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                <span class="comment">! coordinates for frame &quot;frame&quot; are now in xin(:)</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                frame = frame+1</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">!                               write(*,*) &#39;frame= &#39;, frame</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                <span class="keywordflow">if</span>(frames.ne.<span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                        <span class="keywordflow">if</span>(every_n.eq.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                                <span class="keywordflow">if</span>(frame&gt;=frame_start.and.frame&lt;=frame_end) call <a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a>(cf, frame)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                                <span class="keywordflow">if</span>(modulo(frame,every_n).eq.0) call <a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a>(cf,frame)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                        call <a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a>(cf, frame)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        call <a class="code" href="classtrj.html#a0e950363c678b3b896b3484d1ffa298e">trj_close</a></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a7d2d447954fb385bdca4f228de92b1eb">process_data</a></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">  282</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a>(cf, frame)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">!arguments</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordtype">character(*)</span>                    ::      cf</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordtype">integer</span>                                         ::      frame</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordtype">character(len=32)</span> :: filename</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> (len_trim(cf) .gt. 20) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                filename(1:5)  = cf(1:5)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                filename(6:8)  = <span class="stringliteral">&#39;...&#39;</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                filename(9:20) = cf(len_trim(cf)-11:len_trim(cf))</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                filename(:) = <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                filename(1:len_trim(cf)) = cf(1:len_trim(cf))</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keyword">write</span>(*, 100, advance=<span class="stringliteral">&#39;no&#39;</span>) filename, frame</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;100     <span class="keyword">format</span>(a21, i4)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        call <a class="code" href="qcalc_8f90.html#a5befd1d444d41d7d1e4bf8b297c17ee2">calc_all</a>(frame)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">write</span>(*,*) <span class="comment">!new line                                            </span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a93dcacb957411ed0d0471fe8a31c60d6">process_frame</a></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a164c08954086777fab0abf50fc431b85">  305</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a164c08954086777fab0abf50fc431b85">make_mean_all</a>                                <span class="comment">! calls mean routines in other modules</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordtype">integer</span> :: c</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">do</span> c = 1, ncalcs</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(c)%typ)%key)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                call <a class="code" href="classcalc__chemscore.html#a745d266685ca3b123d11d20d0baf1dec">score_mean</a></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                call <a class="code" href="classcalc__xscore.html#a9f44d606adb68d2cfa8ada438d0580bd">xscore_mean</a></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                call <a class="code" href="classcalc__pmf.html#aeb687d57198896c002165b074ebd8e16">pmfscore_mean</a></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;       <span class="comment">!add more call to mean routines here...</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;         <span class="keywordflow">end do</span> </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a164c08954086777fab0abf50fc431b85">make_mean_all</a>    </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">  322</a></span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a>(cf, fn, frames)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">!arguments</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordtype">character(len=256)</span>, <span class="keywordtype">intent(out)</span> :: cf</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>                                            :: fn</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordtype">character(len=80)</span>,<span class="keywordtype">optional</span>                      :: frames</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">!locals</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordtype">integer</span>                                         :: filestat,p</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordtype">character(len=4)</span>        :: trj_type</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a> = .false.</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">do</span> </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keyword">read</span>(*,<span class="stringliteral">&#39;(a)&#39;</span>, iostat=filestat) cf</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">if</span>(filestat /= 0) <span class="keywordflow">exit</span> <span class="comment">!EOF on input</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">if</span>(cf == <span class="stringliteral">&#39;end&#39;</span> .or. cf == <span class="stringliteral">&#39;END&#39;</span> .or. cf == <span class="stringliteral">&#39;.&#39;</span>) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="keywordflow">if</span>(cf == <span class="stringliteral">&#39;mean&#39;</span> .or. cf == <span class="stringliteral">&#39;MEAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        call <a class="code" href="qcalc_8f90.html#a164c08954086777fab0abf50fc431b85">make_mean_all</a></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                        cycle</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">if</span>(cf == <span class="stringliteral">&#39;ref&#39;</span> .or. cf == <span class="stringliteral">&#39;REF&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        call <a class="code" href="qcalc_8f90.html#a804c759c2b0626d4cc6a056e0e1fdb4b">make_ref_all</a>(xin)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&#39;Updated reference coordinate set.&#39;</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        cycle</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="comment">! see if user specified frame interval</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                p = index(cf,<span class="stringliteral">&#39;,&#39;</span>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span>(p.ne.0.and.present(frames)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        frames = adjustl(trim(cf(p+1:256)))</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        cf = adjustl(trim(cf(1:p-1)))</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <span class="keywordflow">elseif</span>(present(frames)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        frames = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="comment">!open file if filename was specified</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                fn = <a class="code" href="classmisc.html#aaa874447823dfa2d2c7fcf6eb80ebd70">freefile</a>()</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keyword">open</span>(unit=fn, file=cf, status=<span class="stringliteral">&#39;old&#39;</span>, action=<span class="stringliteral">&#39;read&#39;</span>, form=<span class="stringliteral">&#39;unformatted&#39;</span>, &amp;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        iostat=filestat)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">if</span>(filestat /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        <span class="keyword">write</span>(*,900) trim(cf)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;900                     <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: failed to open &#39;</span>,a)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        cycle</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                        <span class="comment">!determine type</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                        </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                        <span class="keyword">read</span>(fn) trj_type</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                        <span class="keywordflow">if</span>(trj_type == <span class="stringliteral">&#39;CORD&#39;</span>) <span class="keywordflow">then</span> <span class="comment">!it&#39;s a trajectory</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                <span class="comment">!it is read by the trajectory module</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                <span class="keyword">close</span>(fn)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                fn = 0</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                <a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a> = <a class="code" href="classtrj.html#a28cdf7fe7d02d22fcf44b14c41cd292c">trj_open</a>(cf)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                <span class="keywordflow">if</span>(<a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                        <span class="comment">!write the reference coordinates into xin </span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                        <span class="comment">!so that atoms not in the trajectory</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                        <span class="comment">!get their reference coordinates</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                        xin(:) = xtop(:)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        <span class="keywordflow">else</span> <span class="comment">!is&#39;s a restrart file</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                backspace(fn)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                <a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a> = .true.</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                        <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keyword">end function </span><a class="code" href="qcalc_8f90.html#a1d82cd2a089e1e0ca370862a88297fad">get_coordfile</a></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">  391</a></span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">load_restart</a>(fn)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">!arguments</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>                     ::      fn</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment">!locals</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">integer(4)</span>                                      ::      nat3</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordtype">integer</span>                                         ::      filestat</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">load_restart</a> = .false.</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        rewind(fn)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keyword">read</span>(fn, iostat=filestat) nat3</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span>(filestat &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keyword">write</span>(*,900) </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;900             <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: Coordinate file read failure.&#39;</span>)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">elseif</span>(filestat &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="comment">! EOF - do nothing</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">elseif</span>(nat3 == 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="comment">!We found a polarization restraint data record in a restart file</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="comment">!do nothing</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">elseif</span>(nat3 /= 3*nat_pro) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="keyword">write</span>(*,910) nat3/3</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;910             <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: Wrong number of atoms in coordinate file:&#39;</span>,i5)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                backspace(fn)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="keyword">read</span>(fn) nat3, xin(:)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">load_restart</a> = .true.</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keyword">close</span>(fn)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keyword">end function </span><a class="code" href="qcalc_8f90.html#a26df16bfa0021f6226b26f2e715cdb91">load_restart</a></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#ad7e945159c2c3479ab13f7fe344ed0ac">  422</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#ad7e945159c2c3479ab13f7fe344ed0ac">finalize_topology</a></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        call <a class="code" href="classtopo.html#aa6153a7d9918ecb635b405949f7237ee">topo_deallocate</a></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#ad7e945159c2c3479ab13f7fe344ed0ac">finalize_topology</a></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">  426</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a>(desc, key, output)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordtype">character(*)</span>            ::      desc</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordtype">character(*)</span>            ::      key</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordtype">logical</span>                         ::      output</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">If</span>(nkinds == max_calc_kinds) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                stop <span class="stringliteral">&#39;Too many kinds of calculations.&#39;</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        nkinds = nkinds + 1</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        cdef(nkinds)%desc = desc</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        cdef(nkinds)%key = key</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        cdef(nkinds)%output = output</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a9afc3a2b4bf9cf9f8ae01bac7640ab19">add_kind</a></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#abb9b8f865767a4df227883c541fbda4a">  440</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#abb9b8f865767a4df227883c541fbda4a">calc_menu</a></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordtype">integer</span>                                         ::      i</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        call <a class="code" href="classmisc.html#ac616bbb70212f3216e099c51f3c217f9">centered_heading</a>(<span class="stringliteral">&#39;List of calculation types&#39;</span>,<span class="stringliteral">&#39;=&#39;</span>)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keyword">write</span>(*,90) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;command&#39;</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;90      <span class="keyword">format</span>(a2,1x,a,t44,a,t20)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;100     <span class="keyword">format</span>(i2,1x,a,t44,a,t20)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">do</span> i = 1, nkinds</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="keyword">write</span>(*, 100) i, cdef(i)%desc, cdef(i)%key</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keyword">write</span>(*,90) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;Show list of calculations+menu&#39;</span>, <span class="stringliteral">&#39;list&#39;</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keyword">write</span>(*,90) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;Proceed to next phase&#39;</span>, <span class="stringliteral">&#39;go&#39;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#abb9b8f865767a4df227883c541fbda4a">calc_menu</a></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#acaadc7e7a89c09e2f5d003ad5dca1672">  455</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#acaadc7e7a89c09e2f5d003ad5dca1672">add_calcs</a></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordtype">character(len=200)</span>                      ::      input</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordtype">integer</span>                                         ::      kind, readstat</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        call <a class="code" href="qcalc_8f90.html#abb9b8f865767a4df227883c541fbda4a">calc_menu</a>                          <span class="comment">! calc_menu outputs menu and calc. descriptions</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(a)&#39;</span>, advance=<span class="stringliteral">&#39;no&#39;</span>) <span class="stringliteral">&#39;Qcalc&gt; &#39;</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="keyword">read</span>(*,*) input</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keyword">read</span>(input, <span class="stringliteral">&#39;(i5)&#39;</span>, iostat=readstat) kind</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                <span class="keywordflow">if</span>(readstat == 0) <span class="keywordflow">then</span> <span class="comment">!got numeric input</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        <span class="keywordflow">if</span>(kind &lt; 1 .or. kind &gt; nkinds) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                <span class="keyword">write</span>(*,900) kind</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;900                             <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: Command number &#39;</span>,i2,<span class="stringliteral">&#39; is not available.&#39;</span>)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                cycle</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        input = adjustl(input)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        call <a class="code" href="classmisc.html#a809b24676ebbae2412332b832c612c3c">locase</a>(input)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        <span class="keywordflow">if</span>(input == <span class="stringliteral">&#39;go&#39;</span>) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        <span class="keywordflow">if</span>(input == <span class="stringliteral">&#39;list&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                call <a class="code" href="qcalc_8f90.html#ae6fa26c64ed2a712e51850ce137cbdaa">list_calcs</a>         <span class="comment">! outputs list of calcs</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                call <a class="code" href="qcalc_8f90.html#abb9b8f865767a4df227883c541fbda4a">calc_menu</a></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                                cycle</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        <span class="keywordflow">do</span> kind = 1, nkinds</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                <span class="keywordflow">if</span>(cdef(kind)%key == input) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        <span class="keywordflow">if</span>(kind &gt; nkinds) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                                <span class="keyword">write</span>(*,910) trim(input)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;910                             <span class="keyword">format</span>(<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: The command &#39;</span>,a,<span class="stringliteral">&#39; is not available.&#39;</span>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                cycle</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="comment">!at this stage we do have a proper input</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                call <a class="code" href="qcalc_8f90.html#acb44d1dc6dd86deefc875c180bc5703e">add_a_calc</a>(kind)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#acaadc7e7a89c09e2f5d003ad5dca1672">add_calcs</a></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a804c759c2b0626d4cc6a056e0e1fdb4b">  495</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a804c759c2b0626d4cc6a056e0e1fdb4b">make_ref_all</a>(x)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordtype">real(8)</span>                                         ::      x(:)</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordtype">integer</span>                                         ::      i</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">!copy current coordinates to xtop</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        xtop(:) = xin(:)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">do</span> i = 1, ncalcs</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(i)%typ)%key)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsd&#39;</span>)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                        call <a class="code" href="classcalc__rms.html#aa7448d6c01ae57e401ff6ca9cd4cceda">rms_make_ref</a>(calcs(i)%i)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsf&#39;</span>)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                        call <a class="code" href="classcalc__rmsf.html#acc914c615c8477f9d4ef1aefce32593b">rmsf_make_ref</a>(calcs(i)%i)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;fit&#39;</span>)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                        call <a class="code" href="classcalc__fit.html#a912b97a094e4dc8e23a38269dbd4f0dc">fit_make_ref</a>(calcs(i)%i)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a804c759c2b0626d4cc6a056e0e1fdb4b">make_ref_all</a></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#ae6fa26c64ed2a712e51850ce137cbdaa">  517</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#ae6fa26c64ed2a712e51850ce137cbdaa">list_calcs</a></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordtype">integer</span>                                         ::      c</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        call <a class="code" href="classmisc.html#ac616bbb70212f3216e099c51f3c217f9">centered_heading</a>(<span class="stringliteral">&#39;List of defined calculations&#39;</span>,<span class="stringliteral">&#39;=&#39;</span>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">do</span> c=1, ncalcs</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                <span class="keyword">write</span>(*,100) c, calcs(c)%desc</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;100             <span class="keyword">format</span>(i2, 1x, a)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#ae6fa26c64ed2a712e51850ce137cbdaa">list_calcs</a></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#acb44d1dc6dd86deefc875c180bc5703e">  528</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#acb44d1dc6dd86deefc875c180bc5703e">add_a_calc</a>(kind)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordtype">integer</span>         ::      kind</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">if</span>(ncalcs == max_calcs) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&gt; ERROR: Too many calculations.&#39;</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">return</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        ncalcs = ncalcs + 1</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        calcs(ncalcs)%typ = kind</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(kind)%key)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsd&#39;</span>)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__rms.html#ae0ddbab6b86b26808306b08522944087">rms_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsf&#39;</span>)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__rmsf.html#a4e6c49380436639f72a9ca5711477832">rmsf_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;fit&#39;</span>)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__fit.html#a03132293af132901c3309c2095bc97a5">fit_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;dist&#39;</span>)</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__geom.html#a348c8fca0f213a2b56b1dcb981070709">dist_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;angle&#39;</span>)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__geom.html#ae9aa6ab09d34aced5ae66c206327cd74">angle_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;torsion&#39;</span>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__geom.html#ad2c40be3e2901a0ac616ff333cce9efd">torsion_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;entropy&#39;</span>)                                             </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                  calcs(ncalcs)%i = <a class="code" href="classcalc__entropy.html#aed82d686b07a9020efcd8f4587376359">entropy_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nonbond&#39;</span>)                                             </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__nb.html#a1476bae2c246aa70d62c2d574e1c3878">nb_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nb_prot_qatom&#39;</span>)                                             </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                  calcs(ncalcs)%i = <a class="code" href="classcalc__nb.html#a6d26079e3680e2780d8c7f302b538596">nb_qp_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__chemscore.html#a8ac120993f6d7fd6a2d13d1de1ef8a04">score_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__xscore.html#a54166bda8a73b7847edce41e4b3268d5">xscore_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__pmf.html#a4caf9759f3678b95aaa1f48fba8eb333">pmf_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rdf&#39;</span>)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__rdf.html#ab8e05d1bd81788d16237447d9f66edd9">rdf_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com_ke&#39;</span>)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__com__ke.html#a3c4a60a828ca4c037ffd87b608f6a8f7">com_ke_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com&#39;</span>)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                        calcs(ncalcs)%i = <a class="code" href="classcalc__com.html#a651966ec97d83c3b1dfa2698148984c7">com_add</a>(calcs(ncalcs)%desc)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="comment">!add more calls to add routines here...</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span>(calcs(ncalcs)%i == 0) <span class="keywordflow">then</span> <span class="comment">!add failed</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="comment">!remove the empty entry</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                ncalcs = ncalcs - 1</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">else</span> <span class="comment">!successful</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                <span class="keyword">write</span>(*,100) ncalcs, calcs(ncalcs)%desc</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;100             <span class="keyword">format</span>(<span class="stringliteral">&#39;Added calc. #&#39;</span>,i2,<span class="stringliteral">&#39;: &#39;</span>,a)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#acb44d1dc6dd86deefc875c180bc5703e">add_a_calc</a></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#aef9b17e9b0d2c7dda08ad0e502c7369f">  581</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#aef9b17e9b0d2c7dda08ad0e502c7369f">print_headings</a></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordtype">integer</span>                                         ::      c, i</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        call <a class="code" href="qcalc_8f90.html#ae6fa26c64ed2a712e51850ce137cbdaa">list_calcs</a></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        call <a class="code" href="classmisc.html#ac616bbb70212f3216e099c51f3c217f9">centered_heading</a>(<span class="stringliteral">&#39;Calculation results&#39;</span>, <span class="stringliteral">&#39;-&#39;</span>)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keyword">write</span>(*,90, advance=<span class="stringliteral">&#39;no&#39;</span>) <span class="stringliteral">&#39;file&#39;</span>, <span class="stringliteral">&#39;frame&#39;</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;90                      <span class="keyword">format</span>(a, t22, a)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">do</span> c=1, ncalcs</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="keywordflow">if</span>(cdef(calcs(c)%typ)%output) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                        i = calcs(c)%i</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                        <span class="keyword">write</span>(*, 100, advance=<span class="stringliteral">&#39;no&#39;</span>) c</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;100                     <span class="keyword">format</span>(1x,i2,<span class="stringliteral">&#39;:&#39;</span>)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(c)%typ)%key)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsd&#39;</span>)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                call <a class="code" href="classcalc__rms.html#a8d1a0fac027ef6b1f98c5d988fe2f9c8">rms_heading</a>(i)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsf&#39;</span>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                call <a class="code" href="classcalc__rmsf.html#a7bc4d2b20fc6597c1d4fb38d0bd1520c">rmsf_heading</a>(i)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;fit&#39;</span>)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                <span class="comment">!no output - no heading</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;dist&#39;</span>)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                call <a class="code" href="classcalc__geom.html#a1a36de577634902041727339238e94c4">dist_heading</a>(i)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;angle&#39;</span>)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                call <a class="code" href="classcalc__geom.html#abb7f94251454e88ff6e12ccaf78d9489">angle_heading</a>(i)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;torsion&#39;</span>)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                call <a class="code" href="classcalc__geom.html#a06660b196ea23ef719bddf64da4fa039">torsion_heading</a>(i)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nonbond&#39;</span>)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                call <a class="code" href="classcalc__nb.html#aa0c90f5c7303a22f778585374acc4a5f">nb_heading</a>(i)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nb_prot_qatom&#39;</span>)                             </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">!                               call nb_heading(i)</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                call <a class="code" href="classcalc__chemscore.html#a281f50164f92a72afef6055495578adb">score_heading</a>(i)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                call <a class="code" href="classcalc__xscore.html#a0b752f2d11da627f5a032e559c2be351">xscore_heading</a>(i)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                call <a class="code" href="classcalc__pmf.html#a7a15b746c74b0245da6842da20bab499">pmf_heading</a>(i)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rdf&#39;</span>)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                call <a class="code" href="classcalc__rdf.html#a77981fcf63075933497714a8f8f6ba3b">rdf_heading</a>(i)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com_ke&#39;</span>)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                call <a class="code" href="classcalc__com__ke.html#a174b352e5b338775e20a4c1c0e547a35">com_ke_heading</a>(i)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com&#39;</span>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                call <a class="code" href="classcalc__com.html#ac59b689603137407083a080128e002f0">com_heading</a>(i)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        <span class="comment">!add more call to heading routines here...</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">end do</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keyword">write</span>(*,*) <span class="comment">!new line</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#aef9b17e9b0d2c7dda08ad0e502c7369f">print_headings</a></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="code" href="qcalc_8f90.html#a5befd1d444d41d7d1e4bf8b297c17ee2">  632</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="qcalc_8f90.html#a5befd1d444d41d7d1e4bf8b297c17ee2">calc_all</a>(frame)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">integer</span>             ::  frame</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordtype">integer</span>                         ::      c, i</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">do</span> c = 1, ncalcs</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                i = calcs(c)%i</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="keywordflow">if</span>(cdef(calcs(c)%typ)%output) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        <span class="keyword">write</span>(*,100, advance=<span class="stringliteral">&#39;no&#39;</span>)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;100                     <span class="keyword">format</span>(1x)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                <span class="keywordflow">end if</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <span class="keywordflow">select</span> <span class="keywordflow">case</span>(cdef(calcs(c)%typ)%key)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsd&#39;</span>)</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                call <a class="code" href="classcalc__rms.html#a79e74aee349411bedf7f3c71a81b25bb">rms_calc</a>(i)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rmsf&#39;</span>)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                call <a class="code" href="classcalc__rmsf.html#aa06c01d8ab8a9c1e62fe92d36c9a6fc4">rmsf_calc</a>(i)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;fit&#39;</span>)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                call <a class="code" href="classcalc__fit.html#a34e3efb2981d1e8ad36d1556e6f69e18">fit_calc</a>(i)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;dist&#39;</span>)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                call <a class="code" href="classcalc__geom.html#a944ba8085f76be268d1f09a8d26c8afd">dist_calc</a>(i)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;angle&#39;</span>)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                call <a class="code" href="classcalc__geom.html#ac7a76181631ae1bfed15607f66009fe1">angle_calc</a>(i)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;torsion&#39;</span>)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                call <a class="code" href="classcalc__geom.html#a7b26a568cc21cfccd5c6bc8c421c31b7">torsion_calc</a>(i)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;entropy&#39;</span>)                                                  </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                call <a class="code" href="classcalc__entropy.html#aa0d5bd96bcbb6587c5e1e624674e5e4e">entropy_calc</a>(i)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nonbond&#39;</span>)                                                         </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                call <a class="code" href="classcalc__nb.html#ab5ed70a50d41bb040e21f2e88ca8a207">nb_calc</a>(i)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;nb_prot_qatom&#39;</span>)                                                     </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                call <a class="code" href="classcalc__nb.html#a936e04ca43919cd2cacfd48dbfac7d52">nb_qp_calc</a>()</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;chemscore&#39;</span>)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                call <a class="code" href="classcalc__chemscore.html#a678c1ccc18920a66c00a8fe528997561">score_calc</a>(i,frame)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;xscore&#39;</span>)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                call <a class="code" href="classcalc__xscore.html#a1f2c852d7a1ed801d7b14ce6205a384e">xscore_calc</a>(i,frame)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;pmfscore&#39;</span>)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                call <a class="code" href="classcalc__pmf.html#a0e57d1409c14150ce20ffbf26376a485">pmf_calc</a>(i,frame)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;rdf&#39;</span>)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                call <a class="code" href="classcalc__rdf.html#a7ab1dc36ff759913cf0737ae82a2c37b">rdf_calc</a>(i)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com_ke&#39;</span>)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                call <a class="code" href="classcalc__com__ke.html#a4721321fae51d63d7da0b33189366be2">com_ke_calc</a>(i)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;com&#39;</span>)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                call <a class="code" href="classcalc__com.html#a8d29a63ddb97850c536c8acda9856013">com_calc</a>(i)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;       <span class="comment">!add more call to calculation routines here...</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">end select</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;         <span class="keywordflow">end do</span> </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="qcalc_8f90.html#a5befd1d444d41d7d1e4bf8b297c17ee2">calc_all</a></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="keyword">end program </span><a class="code" href="qcalc_8f90.html#af9a59510ab33b6a61b0bffe1e6679be1">qcalc</a></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 9 2015 09:31:33 for qsource by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
